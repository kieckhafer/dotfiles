'use strict';

const ComponentDef = require('./ComponentDef');
const hasRenderBodyKey = Symbol.for("hasRenderBody");

function isInputSerializable(component) {
    var input = component.y_;
    if (!input) {
        return true;
    }

    if (input[hasRenderBodyKey] === true || input.renderBody !== undefined) {
        return false;
    } else {
        return true;
    }
}

module.exports = function beginComponent(component, isSplitComponent) {
    var componentStack = this._j_;
    var origLength = componentStack.length;
    var parentComponentDef = componentStack[origLength - 1];

    var componentId = component.id;

    var componentDef = new ComponentDef(component, componentId, this.X_, componentStack, origLength);

    // On the server
    if (parentComponentDef._o_ === true) {
        componentDef._o_ = true;
    } else {
        parentComponentDef._r_(componentDef);
        if (isSplitComponent === false && this.q_.global.noBrowserRerender !== true && isInputSerializable(component)) {

            componentDef._o_ = true;
        }
    }

    componentStack.push(componentDef);

    return componentDef;
};